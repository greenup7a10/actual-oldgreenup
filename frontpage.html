<!doctype html>
<html lang="vi">
<head>
  <!-- Google tag -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-HVVBRLHDV3"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);} 
    gtag('js', new Date());
    gtag('config', 'G-HVVBRLHDV3');
  </script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Green Up ‚Äî Trang ch·ªß</title>
  <link rel="stylesheet" href="css/style.css?v=9" />
  <script defer src="js/script.js?v=9"></script>

  <style>
  .hero-panel{ position:relative; }
  @media (max-width:860px){ .hero-right{ display:none; } }

  /* ===== Tile grid */
  .tile-grid{
    display:grid; gap:18px; align-items:stretch;
    grid-template-columns: 1fr 1fr;                 /* mobile/tablet: 2 cols */
    grid-template-areas:
      "creators badges"
      "help     info"
      "stats    stats";                              /* stats full width on small screens */
  }
  @media (min-width:980px){
    .tile-grid{
      grid-template-columns: 1fr 1fr 1fr;            /* desktop: 3 cols */
      grid-template-areas:
        "creators badges stats"                      /* stats next to Huy Hi·ªáu */
        "info     help   .";                         /* help sits under Huy Hi·ªáu */
    }
  }
  .tile-creators{ grid-area: creators; }
  .tile-badges  { grid-area: badges; }
  .tile-help    { grid-area: help; }
  .tile-info    { grid-area: info; }
  .stats-slot   { grid-area: stats; display:block; height:100%; }

  .stats-card{
    background:rgba(255,255,255,.92);
    border:1px solid rgba(0,0,0,.08);
    border-radius:14px;
    padding:10px 12px;
    box-shadow:0 2px 10px rgba(0,0,0,.06);
    backdrop-filter:blur(6px);
    height:100%;
    display:flex; flex-direction:column; justify-content:center;
  }
  .stats-title{ margin:0 0 6px; font-weight:900; font-size:14px; }
  .stats-list{ list-style:none; margin:0; padding:0; display:grid; gap:4px; }
  .stats-item{ display:flex; align-items:center; justify-content:space-between; gap:8px; padding:4px 8px; border-radius:10px; background:#fff8; }
  .stats-left{ display:flex; align-items:center; gap:8px; }
  .dot{ width:8px; height:8px; border-radius:999px; display:inline-block; }
  .dot.blue{ background:#1f6feb; }
  .dot.green{ background:#2ea44f; }
  .dot.orange{ background:#d97706; }
  .dot.red{ background:#e11d48; }
  .stats-val{ font-weight:900; font-size:14px; }

  /* week board */
  .week-card{background:rgba(255,255,255,.86);border:1px solid #0001;border-radius:18px;padding:12px;margin:14px 14px 0}
  .wk-title{margin:0 0 6px;font-weight:900}
  .week-range{font-size:12px;opacity:.7;margin-left:8px}
  .wk-list{list-style:none;margin:0;padding:0}
  .wk-item{display:flex;align-items:center;gap:10px;padding:8px 10px;border-bottom:1px dashed #0002}
  .wk-item:last-child{border-bottom:0}
  .wk-item .medal{width:28px;text-align:center;font-size:20px}
  .wk-item .name{font-weight:700}
  .wk-item .count{margin-left:auto;font-weight:900}
  .wk-empty{opacity:.7;padding:10px}
</style>

</head>

<body class="has-bg">
  <header class="topbar">
    <a class="brand brand-normal" href="frontpage.html" id="displayName">T√™n nh√≥m here</a>
    <div class="user-pane" id="userPane">
      <img class="avatar" src="img/logo.png" alt="" />
      <div class="user-meta">
        <button id="userMenuBtn" class="user-trigger" type="button" aria-haspopup="menu" aria-expanded="false" aria-controls="userMenu">
          <span id="headerUsername">username</span>
        </button>
        <div class="user-stats">
          <span class="stat"><img src="img/leaf.png" alt="" class="stat-icon" /><span id="leafCount">0</span></span>
          <span class="stat"><img src="img/fire.png" alt="" class="stat-icon" /><span id="streakCount">0</span></span>
        </div>
      </div>
      <div id="userMenu" class="user-menu" role="menu" aria-label="User menu">
        <button id="logoutBtn" class="menu-item" role="menuitem" type="button">Logout</button>
      </div>
    </div>
  </header>

  <nav class="primary-nav" aria-label="Primary">
    <a href="frontpage.html" data-page="home" aria-current="page">Trang Ch·ªß</a>
    <a href="about-us.html" data-page="about">Gi·ªõi Thi·ªáu</a>
    <a href="tin-tuc.html" data-page="news">Tin T·ª©c</a>
    <a href="green-up.html" data-page="greenup">Green Up</a>
    <a href="achievements.html" data-page="achievements">Huy Hi·ªáu</a>
    <a href="helpandcontact.html" data-page="help">Tr·ª£ Gi√∫p &amp; Li√™n H·ªá</a>
  </nav>

  <main class="front-main">
    <section class="hero-panel">
      <div class="hero-left">
        <h2 class="vn-line-1">B·∫°n ƒë√£ th·ª±c s·ª±</h2>
        <h2 class="vn-line-2">‚ÄúS·ªëng xanh‚Äù?</h2>
      </div>
      <div class="hero-right" aria-hidden="true"><img src="img/globe.png" alt="" class="hero-globe" /></div>
    </section>

    <section class="tile-grid" aria-label="Li√™n k·∫øt nhanh">
      <a class="tile tile-creators" href="creators.html">
        <div class="tile-top blue"></div>
        <img src="img/creators-logo.png" alt="" class="tile-icon" />
        <h3>Ban S√°ng L·∫≠p</h3>
      </a>

      <a class="tile tile-badges" href="achievements.html">
        <div class="tile-top red"></div>
        <img src="img/achievements-logo.png" alt="" class="tile-icon" />
        <h3>Huy Hi·ªáu</h3>
      </a>

      <a class="tile tile-help" href="helpandcontact.html">
        <div class="tile-top teal"></div>
        <img src="img/help-logo.png" alt="" class="tile-icon" />
        <h3>Tr·ª£ gi√∫p &amp; Li√™n h·ªá</h3>
      </a>

      <a class="tile tile-info" href="about-us.html">
        <div class="tile-top yellow"></div>
        <img src="img/about-us-logo.png" alt="" class="tile-icon" />
        <h3>Th√¥ng tin</h3>
      </a>

      <!-- stats -->
      <div class="stats-slot" role="region" aria-label="Th·ªëng K√™ Truy C·∫≠p">
        <aside class="stats-card" aria-live="polite">
          <div class="stats-title">Th·ªëng K√™ Truy C·∫≠p</div>
          <ul class="stats-list">
            <li class="stats-item"><div class="stats-left"><span class="dot blue"></span>H√¥m nay</div><div class="stats-val" id="ga-today">‚Äî</div></li>
            <li class="stats-item"><div class="stats-left"><span class="dot green"></span>Tu·∫ßn n√†y</div><div class="stats-val" id="ga-week">‚Äî</div></li>
            <li class="stats-item"><div class="stats-left"><span class="dot orange"></span>Th√°ng n√†y</div><div class="stats-val" id="ga-month">‚Äî</div></li>
            <li class="stats-item"><div class="stats-left"><span class="dot red"></span>T·ªïng (k·ªÉ t·ª´ ng√†y 11/10/2025)</div><div class="stats-val" id="ga-total">‚Äî</div></li>
          </ul>
        </aside>
      </div>
    </section>

    <!-- Weekly Leaderboard  -->
    <section class="week-card" aria-live="polite">
      <div style="display:flex;align-items:baseline;gap:8px">
        <h3 class="wk-title">X·∫øp H·∫°ng Tu·∫ßn</h3>
        <span id="wkRange" class="week-range"></span>
      </div>
      <ol id="weeklyBoard" class="wk-list"></ol>
    </section>

    <p class="cta-wrap"><a class="cta" href="green-up.html">L√ÄM TH·∫æ N√ÄO ƒê·ªÇ GREEN UP?</a></p>
  </main>

  <footer class="island-footer">
    <div class="footer-left">
      <nav class="footer-nav" aria-label="Footer">
        <a href="frontpage.html">Trang ch·ªß</a>
        <a href="about-us.html">Gi·ªõi Thi·ªáu</a>
        <a href="helpandcontact.html">Li√™n H·ªá</a>
      </nav>
      <div class="footer-underline" aria-hidden="true"></div>
      <div class="footer-school">THCS v√† THPT Tr·∫ßn ƒê·∫°i Nghƒ©a</div>
    </div>
    <div class="footer-contact">
      <img src="img/call-icon.png" alt="" class="phone-icon" />
      <div><div class="contact-title">Li√™n H·ªá</div><a class="tel" href="tel:0963705622">0963 705 622</a></div>
    </div>
  </footer>

  <!-- GA4 stats fetch  -->
  <script>
  (function(){
    const ENDPOINT = 'https://script.google.com/macros/s/AKfycbwReM3nfx6wAWTHsRvkmzbCZwLE9jvxpwzL2BcIrChZHHkwQ2DAO2cSDNNZnPYYU9CbSg/exec';
    const el = {
      today:  document.getElementById('ga-today'),
      week:   document.getElementById('ga-week'),
      month:  document.getElementById('ga-month'),
      total:  document.getElementById('ga-total'),
    };
    const fmt = n => Number(n||0).toLocaleString('vi-VN');
    const pick = (o,keys)=>{ for(const k of keys) if(o&&o[k]!=null) return o[k]; return null; };

    async function loadStats(){
      try{
        Object.values(el).forEach(e => e.textContent = '‚Ä¶');
        const res  = await fetch(ENDPOINT, { cache: 'no-store' });
        const data = await res.json();
        el.today.textContent = fmt(pick(data, ['today','activeUsersToday','todayUsers','realtime']));
        el.week.textContent  = fmt(pick(data, ['week','sevenDayUsers','last7Days','thisWeek']));
        el.month.textContent = fmt(pick(data, ['month','thirtyDayUsers','last30Days','thisMonth']));
        el.total.textContent = fmt(pick(data, ['total','lifetimeUsers','totalUsers','allTime']));
      } catch (err){
        console.error('GA stats fetch failed', err);
        Object.values(el).forEach(e => e.textContent = '‚Äî');
      }
    }
    loadStats();
    setInterval(loadStats, 5 * 60 * 1000);
  })();
  </script>

  <!-- Weekly leaderboard -->
  <script>
  (function () {
    const LB_ENDPOINT = 'https://script.google.com/macros/s/AKfycbxr2A9ed0w0UXV5bEr83DqyZQsKGivT3u3gs79I8a7RgKAyWEu4eiwHPl5oTXgjpggxQA/exec';
    function loadEntries(){ try { return JSON.parse(localStorage.getItem('greenup_entries')||'[]'); } catch { return []; } }
    function weekBounds(d=new Date()){ const now=new Date(d), day=now.getDay(), diff=(day===0?-6:1-day);
      const s=new Date(now); s.setHours(0,0,0,0); s.setDate(now.getDate()+diff);
      const e=new Date(s); e.setDate(s.getDate()+6); e.setHours(23,59,59,999); return {start:s,end:e}; }
    const fmtVN = dt => dt.toLocaleDateString('vi-VN',{day:'2-digit',month:'2-digit'});
    const esc = s => String(s||'').replace(/[&<>"']/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;' }[m]));
    function renderRange(s,e){ const el=document.getElementById('wkRange'); if(el) el.textContent=`(${fmtVN(s)} ‚Äì ${fmtVN(e)})`; }
    function render(rows,note){
      const host=document.getElementById('weeklyBoard'); if(!host) return;
      if(note) host.insertAdjacentHTML('beforebegin', `<div style="font-size:12px;opacity:.7;margin:6px 14px 0">${esc(note)}</div>`);
      if(!rows||!rows.length){ host.innerHTML='<li class="wk-empty">Ch∆∞a c√≥ ho·∫°t ƒë·ªông n√†o trong tu·∫ßn n√†y.</li>'; return; }
      host.innerHTML=rows.map((r,i)=>{ const m=i===0?'ü•á':i===1?'ü•à':i===2?'ü•â':(i+1)+'.';
        return `<li class="wk-item"><span class="medal">${m}</span><span class="name">${esc(r.name)}</span><span class="count">${r.count}</span></li>`; }).join('');
    }
    function buildLocal(){
      const {start,end}=weekBounds(); renderRange(start,end);
      const entries=loadEntries().filter(e=>{ const t=new Date(e?.when||Date.now()); return t>=start && t<=end; });
      const map=new Map(); entries.forEach(e=>{ const d=e?.describe||{}, raw=d.fullName||d.hoTen||d.name||e.fullName||'', key=(raw||'').trim().toLowerCase();
        if(!key) return; const cur=map.get(key)||{name:(raw||'').trim(),count:0}; cur.count+=1; map.set(key,cur); });
      const ranked=Array.from(map.values()).sort((a,b)=>b.count-a.count||a.name.localeCompare(b.name)).slice(0,10);
      render(ranked,'Hi·ªÉn th·ªã d·ªØ li·ªáu c·ª•c b·ªô (fallback).');
    }
    function normalize(data){
      let rows=[]; if(Array.isArray(data)) rows=data;
      else if(Array.isArray(data.rows)) rows=data.rows;
      else if(Array.isArray(data.leaderboard)) rows=data.leaderboard;
      return rows.map(r=>({ name:r.name ?? r.fullName ?? r.user ?? (Array.isArray(r)?r[0]:'‚Äî'),
                            count:Number(r.count ?? r.total ?? r.score ?? (Array.isArray(r)?r[1]:0)) }))
                 .filter(x=>x&&x.name);
    }
    async function fetchLB(){
      for (const url of [LB_ENDPOINT+'?fn=leaderboard', LB_ENDPOINT]){
        try{ const res=await fetch(url,{cache:'no-store'}); if(res.type==='opaque') throw 0; if(!res.ok) continue; return await res.json(); }catch{}
      } throw new Error('No JSON from leaderboard endpoint.');
    }
    async function loadGlobal(){ try{
      const data=await fetchLB(); if(data?.range?.start&&data?.range?.end){ renderRange(new Date(data.range.start), new Date(data.range.end)); }
      else{ const {start,end}=weekBounds(); renderRange(start,end); }
      render(normalize(data).slice(0,10));
    }catch(e){ console.warn('LB fallback',e); buildLocal(); } }
    loadGlobal();
  })();
  </script>
</body>
</html>
